<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript" src="ray.js"></script>
	<script type="text/javascript" src="jquery.min.js"></script>
	<script type="text/javascript">
		$(() => {
			var width = 800, height = width, zoom = 50;

			var canvas = $('#canvas');
			var ctx = canvas.get(0).getContext('2d');

			canvas.attr({width:width, height:height});

			var img = ctx.getImageData(0,0,width,height);
			calculateParameterSpace(img,
				Vec(-width/(2*zoom), height/(2*zoom)),
				Vec((width-1)/zoom, 0),
				Vec(0, -(height-1)/zoom),
			)

			draw(1000,0); // just to show something

			canvas.mousemove(function (e) {
				draw((e.offsetX - width/2)/zoom, (height/2 - e.offsetY)/zoom)
			})

			function draw(x,y) {
				var pos = Vec(x, y);
				var dir = Vec(0, 1).normalize();

				var result = calculatePathSchwarzschild(pos, dir);

				var path = result.path;

				ctx.clearRect(0,0,width,height);
				ctx.putImageData(img,0,0);
				
				ctx.lineWidth = 1;
				ctx.font = '14px sans-serif';
				ctx.textAlign = 'center';

				ctx.beginPath();
				//ctx.fillStyle = '#444';
				ctx.strokeStyle = 'rgba(255,0,0,0.3)';
				ctx.arc(width/2, height/2, zoom, 0, Math.PI*2);
				ctx.stroke();
				//ctx.fill();

				//ctx.fillStyle = '#000';
				//ctx.textBaseline = 'middle';
				//ctx.fillText('r=1m', width/2, height/2);

				ctx.beginPath();
				ctx.strokeStyle = 'rgba(255,0,0,0.3)';
				ctx.arc(width/2, height/2, zoom*2, 0, Math.PI*2);
				ctx.stroke();

				ctx.beginPath();
				ctx.strokeStyle = 'rgba(255,0,0,0.3)';
				ctx.arc(width/2, height/2, zoom*3, 0, Math.PI*2);
				ctx.stroke();

				//ctx.textBaseline = 'top';
				//ctx.fillText('r=3m', width/2, height/2 + zoom*3);
				
				drawPath();

				$('#output').text(result.L+', '+(result.L*result.L));

				function drawPath() {
					ctx.strokeStyle = '#fff';
					ctx.beginPath();
					path.forEach((e,i) => {
						var p = e.pos;
						var x =  width/2 + p.x*zoom;
						var y = height/2 - p.y*zoom;
						if (i === 0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
					})
					ctx.stroke();
				}
			}
		})
	</script>
	<style type="text/css">
		body {
			margin: 0;
			background: #000;
		}
	</style>
</head>
<body>
	<canvas id="canvas"></canvas>
	<div id="output" style="font-family: sans-serif; color: #aaa"></div>
</body>
</html>